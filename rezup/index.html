
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://davidlatwe.github.io/rezup/rezup/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>rezup - rezup</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="rezup" class="md-header__button md-logo" aria-label="rezup" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            rezup
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              rezup
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/davidlatwe/rezup/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="rezup" class="md-nav__button md-logo" aria-label="rezup" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    rezup
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/davidlatwe/rezup/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../container/" class="md-nav__link">
        Container
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../command/" class="md-nav__link">
        Command
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/" class="md-nav__link">
        Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../environ/" class="md-nav__link">
        Environ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          rezup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        rezup
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containerrecipe" class="md-nav__link">
    ContainerRecipe
  </a>
  
    <nav class="md-nav" aria-label="ContainerRecipe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rezup.recipe.ContainerRecipe" class="md-nav__link">
    rezup.recipe.ContainerRecipe
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.recipe.ContainerRecipe.create" class="md-nav__link">
    create()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.recipe.ContainerRecipe.iter_recipes" class="md-nav__link">
    iter_recipes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.recipe.ContainerRecipe.path" class="md-nav__link">
    path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.recipe.ContainerRecipe.provisional_recipes" class="md-nav__link">
    provisional_recipes()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get_container_root" class="md-nav__link">
    get_container_root
  </a>
  
    <nav class="md-nav" aria-label="get_container_root">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rezup.container.get_container_root" class="md-nav__link">
    rezup.container.get_container_root
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container" class="md-nav__link">
    Container
  </a>
  
    <nav class="md-nav" aria-label="Container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container" class="md-nav__link">
    rezup.container.Container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.create" class="md-nav__link">
    create()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.get_latest_revision" class="md-nav__link">
    get_latest_revision()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.get_revision_by_time" class="md-nav__link">
    get_revision_by_time()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.is_empty" class="md-nav__link">
    is_empty()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.is_exists" class="md-nav__link">
    is_exists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.is_remote" class="md-nav__link">
    is_remote()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.iter_revision" class="md-nav__link">
    iter_revision()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.libs" class="md-nav__link">
    libs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.new_revision" class="md-nav__link">
    new_revision()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.path" class="md-nav__link">
    path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.recipe" class="md-nav__link">
    recipe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.revisions" class="md-nav__link">
    revisions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.root" class="md-nav__link">
    root()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revision" class="md-nav__link">
    Revision
  </a>
  
    <nav class="md-nav" aria-label="Revision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision" class="md-nav__link">
    rezup.container.Revision
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.get_rez_version" class="md-nav__link">
    get_rez_version()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.locate_rez_lib" class="md-nav__link">
    locate_rez_lib()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.production_bin_dir" class="md-nav__link">
    production_bin_dir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.pull" class="md-nav__link">
    pull()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.spawn_shell" class="md-nav__link">
    spawn_shell()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.use" class="md-nav__link">
    use()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containererror" class="md-nav__link">
    ContainerError
  </a>
  
    <nav class="md-nav" aria-label="ContainerError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rezup.exceptions.ContainerError" class="md-nav__link">
    rezup.exceptions.ContainerError
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rezup.util/" class="md-nav__link">
        rezup.util
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rezup.util_env/" class="md-nav__link">
        rezup.util_env
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containerrecipe" class="md-nav__link">
    ContainerRecipe
  </a>
  
    <nav class="md-nav" aria-label="ContainerRecipe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rezup.recipe.ContainerRecipe" class="md-nav__link">
    rezup.recipe.ContainerRecipe
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.recipe.ContainerRecipe.create" class="md-nav__link">
    create()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.recipe.ContainerRecipe.iter_recipes" class="md-nav__link">
    iter_recipes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.recipe.ContainerRecipe.path" class="md-nav__link">
    path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.recipe.ContainerRecipe.provisional_recipes" class="md-nav__link">
    provisional_recipes()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get_container_root" class="md-nav__link">
    get_container_root
  </a>
  
    <nav class="md-nav" aria-label="get_container_root">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rezup.container.get_container_root" class="md-nav__link">
    rezup.container.get_container_root
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container" class="md-nav__link">
    Container
  </a>
  
    <nav class="md-nav" aria-label="Container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container" class="md-nav__link">
    rezup.container.Container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.create" class="md-nav__link">
    create()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.get_latest_revision" class="md-nav__link">
    get_latest_revision()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.get_revision_by_time" class="md-nav__link">
    get_revision_by_time()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.is_empty" class="md-nav__link">
    is_empty()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.is_exists" class="md-nav__link">
    is_exists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.is_remote" class="md-nav__link">
    is_remote()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.iter_revision" class="md-nav__link">
    iter_revision()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.libs" class="md-nav__link">
    libs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.name" class="md-nav__link">
    name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.new_revision" class="md-nav__link">
    new_revision()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.path" class="md-nav__link">
    path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.recipe" class="md-nav__link">
    recipe()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.revisions" class="md-nav__link">
    revisions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Container.root" class="md-nav__link">
    root()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revision" class="md-nav__link">
    Revision
  </a>
  
    <nav class="md-nav" aria-label="Revision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision" class="md-nav__link">
    rezup.container.Revision
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.get_rez_version" class="md-nav__link">
    get_rez_version()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.locate_rez_lib" class="md-nav__link">
    locate_rez_lib()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.production_bin_dir" class="md-nav__link">
    production_bin_dir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.pull" class="md-nav__link">
    pull()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.spawn_shell" class="md-nav__link">
    spawn_shell()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rezup.container.Revision.use" class="md-nav__link">
    use()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containererror" class="md-nav__link">
    ContainerError
  </a>
  
    <nav class="md-nav" aria-label="ContainerError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rezup.exceptions.ContainerError" class="md-nav__link">
    rezup.exceptions.ContainerError
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/davidlatwe/rezup/edit/master/docs/rezup.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h2 id="_1"></h2>
<h1 id="containerrecipe">ContainerRecipe</h1>


  <div class="doc doc-object doc-class">

<a id="rezup.recipe.ContainerRecipe"></a>
    <div class="doc doc-contents first">

      <p>A dict-like representation of container's recipe</p>
<p>The recipe file of default container '.main' will be '~/rezup.toml'</p>
<p>And for other container, it will be <code>~/rezup.{name}.toml</code>
for example:
    * <code>~/rezup.dev.toml</code>  -&gt; container <code>dev</code>
    * <code>~/rezup.test.toml</code> -&gt; container <code>test</code></p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>Container name</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/recipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ContainerRecipe</span><span class="p">(</span><span class="n">BaseRecipe</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A dict-like representation of container&#39;s recipe</span>

<span class="sd">    The recipe file of default container &#39;.main&#39; will be &#39;~/rezup.toml&#39;</span>

<span class="sd">    And for other container, it will be `~/rezup.{name}.toml`</span>
<span class="sd">    for example:</span>
<span class="sd">        * `~/rezup.dev.toml`  -&gt; container `dev`</span>
<span class="sd">        * `~/rezup.test.toml` -&gt; container `test`</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str, optional): Container name</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;rezup.?(.*).toml&quot;</span><span class="p">)</span>
    <span class="n">RECIPES_DIR</span> <span class="o">=</span> <span class="n">DEFAULT_CONTAINER_RECIPES</span>  <span class="c1">#: `DEFAULT_CONTAINER_RECIPES`</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ContainerRecipe</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
        <span class="k">if</span> <span class="n">_name</span> <span class="ow">and</span> <span class="n">_name</span> <span class="o">!=</span> <span class="n">DEFAULT_CONTAINER_NAME</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="s2">&quot;rezup.</span><span class="si">%s</span><span class="s2">.toml&quot;</span> <span class="o">%</span> <span class="n">_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="s2">&quot;rezup.toml&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">provisional_recipes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Context for changing recipes root temporarily</span>

<span class="sd">        Container recipes should be in user&#39;s home directory by defaule, but</span>
<span class="sd">        that could be changed inside this context for the case when you need</span>
<span class="sd">        to operate on machines that have no recipe exists in home directory.</span>

<span class="sd">        ```</span>
<span class="sd">        with ContainerRecipe.provisional_recipes(&quot;/to/other/recipes&quot;):</span>
<span class="sd">            ...</span>
<span class="sd">        ```</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str or path-like): directory path where recipes located</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">RECIPES_DIR</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">RECIPES_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">RECIPES_DIR</span> <span class="o">=</span> <span class="n">default</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">iter_recipes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iter all recipe files found in `ContainerRecipe.RECIPES_DIR`</span>
<span class="sd">        Yields:</span>
<span class="sd">            `ContainerRecipe`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">RECIPES_DIR</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">REGEX</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">yield</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the file path of this recipe</span>
<span class="sd">        Returns:</span>
<span class="sd">            pathlib.Path: The file path of this recipe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RECIPES_DIR</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write out recipe content into a .toml file</span>
<span class="sd">        Args:</span>
<span class="sd">            data (dict, optional): Arbitrary data to write out</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">RECIPES_DIR</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RECIPES_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RECIPE</span><span class="p">))</span>
            <span class="n">deep_update</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">toml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># read &amp; write as plaintext, so the comment can be preserved</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RECIPE</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  <div class="doc doc-object doc-method">



<h2 id="rezup.recipe.ContainerRecipe.create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Write out recipe content into a .toml file</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>data</code></td>
        <td><code>dict</code></td>
        <td><p>Arbitrary data to write out</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/recipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write out recipe content into a .toml file</span>
<span class="sd">    Args:</span>
<span class="sd">        data (dict, optional): Arbitrary data to write out</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">RECIPES_DIR</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RECIPES_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">_data</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RECIPE</span><span class="p">))</span>
        <span class="n">deep_update</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">toml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># read &amp; write as plaintext, so the comment can be preserved</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RECIPE</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.recipe.ContainerRecipe.iter_recipes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">iter_recipes</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Iter all recipe files found in <code>ContainerRecipe.RECIPES_DIR</code></p>

<p><strong>Yields:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p><code>ContainerRecipe</code></p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/recipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">iter_recipes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iter all recipe files found in `ContainerRecipe.RECIPES_DIR`</span>
<span class="sd">    Yields:</span>
<span class="sd">        `ContainerRecipe`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">RECIPES_DIR</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">REGEX</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">yield</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.recipe.ContainerRecipe.path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Returns the file path of this recipe</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>pathlib.Path</code></td>
      <td><p>The file path of this recipe</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/recipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the file path of this recipe</span>
<span class="sd">    Returns:</span>
<span class="sd">        pathlib.Path: The file path of this recipe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RECIPES_DIR</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.recipe.ContainerRecipe.provisional_recipes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">provisional_recipes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Context for changing recipes root temporarily</p>
<p>Container recipes should be in user's home directory by defaule, but
that could be changed inside this context for the case when you need
to operate on machines that have no recipe exists in home directory.</p>
<div class="highlight"><pre><span></span><code>with ContainerRecipe.provisional_recipes(&quot;/to/other/recipes&quot;):
    ...
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>str or path-like</code></td>
        <td><p>directory path where recipes located</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/recipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">provisional_recipes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Context for changing recipes root temporarily</span>

<span class="sd">    Container recipes should be in user&#39;s home directory by defaule, but</span>
<span class="sd">    that could be changed inside this context for the case when you need</span>
<span class="sd">    to operate on machines that have no recipe exists in home directory.</span>

<span class="sd">    ```</span>
<span class="sd">    with ContainerRecipe.provisional_recipes(&quot;/to/other/recipes&quot;):</span>
<span class="sd">        ...</span>
<span class="sd">    ```</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str or path-like): directory path where recipes located</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">RECIPES_DIR</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">RECIPES_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">RECIPES_DIR</span> <span class="o">=</span> <span class="n">default</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h1 id="get_container_root">get_container_root</h1>
<p><em>Internal use</em></p>


  <div class="doc doc-object doc-function">

<a id="rezup.container.get_container_root"></a>
    <div class="doc doc-contents first">

      <p>Get container root path from recipe</p>
<div class="highlight"><pre><span></span><code><span class="c1"># rezup.foo.toml</span>
<span class="k">[root]</span>
<span class="n">local</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">remote</span> <span class="o">=</span> <span class="s">&quot;/path/to/remote/containers&quot;</span>
</code></pre></div>
<p>If the <code>recipe</code> represents the above example recipe file, container named
<code>foo</code> will have local root set to <code>rezup.recipe.DEFAULT_CONTAINER_RECIPES</code>,
unless environ variable <code>REZUP_ROOT_LOCAL</code> has value. And the remote root
will set to <code>/path/to/remote/containers</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>recipe</code></td>
        <td><code>`ContainerRecipe`</code></td>
        <td><p>The container recipe to lookup from.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>remote</code></td>
        <td><code>bool</code></td>
        <td><p>Fetch remote root if True, otherwise local.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>`pathlib.Path`</code></td>
      <td><p>Container root path, local or remote one.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_container_root</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="n">remote</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get container root path from recipe</span>

<span class="sd">    ```toml</span>
<span class="sd">    # rezup.foo.toml</span>
<span class="sd">    [root]</span>
<span class="sd">    local = &quot;&quot;</span>
<span class="sd">    remote = &quot;/path/to/remote/containers&quot;</span>

<span class="sd">    ```</span>

<span class="sd">    If the `recipe` represents the above example recipe file, container named</span>
<span class="sd">    `foo` will have local root set to `rezup.recipe.DEFAULT_CONTAINER_RECIPES`,</span>
<span class="sd">    unless environ variable `REZUP_ROOT_LOCAL` has value. And the remote root</span>
<span class="sd">    will set to `/path/to/remote/containers`.</span>

<span class="sd">    Args:</span>
<span class="sd">        recipe (`ContainerRecipe`): The container recipe to lookup from.</span>
<span class="sd">        remote (bool): Fetch remote root if True, otherwise local.</span>

<span class="sd">    Returns:</span>
<span class="sd">        `pathlib.Path`: Container root path, local or remote one.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">remote</span><span class="p">:</span>
        <span class="n">remote</span> <span class="o">=</span> \
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">][</span><span class="s2">&quot;remote&quot;</span><span class="p">]</span> \
            <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REZUP_ROOT_REMOTE&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">norm_path</span><span class="p">(</span><span class="n">remote</span><span class="p">))</span> <span class="k">if</span> <span class="n">remote</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">local</span> <span class="o">=</span> \
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">][</span><span class="s2">&quot;local&quot;</span><span class="p">]</span> \
            <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REZUP_ROOT_LOCAL&quot;</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="s2">&quot;~/.rezup&quot;</span>

        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">norm_path</span><span class="p">(</span><span class="n">local</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>

<h1 id="container">Container</h1>


  <div class="doc doc-object doc-class">

<a id="rezup.container.Container"></a>
    <div class="doc doc-contents first">

      <p>Timestamp ordered virtual environment stack</p>
<p>A Rez venv provider, that allows updating venv continuously without
affecting any existing consumer.</p>
<p>In filesystem, a container is a folder that has at least one Rez venv
installation exists, and those Rez venv folders (<code>Revision</code>) are named
by timestamp, so when the container is being asked for a venv to use,
the current latest available one will be sorted out.</p>
<p>The location of the container can be set with env var <code>REZUP_ROOT_LOCAL</code>
or <code>~/.rezup</code> will be used by default.</p>
<p>For centralize management in production, one remote container can be
defined with an env var <code>REZUP_ROOT_REMOTE</code>. The remote container only
contains the venv installation manifest file, and when being asked, a
venv will be created locally or re-used if same revision exists in local.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>`str`</code></td>
        <td><p>Container name, use <code>Container.DEFAULT_NAME</code>
if not given.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>recipe</code></td>
        <td><code>`ContainerRecipe`</code></td>
        <td><p>A <code>ContainerRecipe</code> object to
help constructing container, will look into <code>ContainerRecipe.RECIPES_DIR</code>
if not given.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>force_local</code></td>
        <td><code>`bool`</code></td>
        <td><p>Default <code>False</code>. Ignore linking remote
even if the remote path has set, always link to local if <code>True</code>.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Container</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Timestamp ordered virtual environment stack</span>

<span class="sd">    A Rez venv provider, that allows updating venv continuously without</span>
<span class="sd">    affecting any existing consumer.</span>

<span class="sd">    In filesystem, a container is a folder that has at least one Rez venv</span>
<span class="sd">    installation exists, and those Rez venv folders (`Revision`) are named</span>
<span class="sd">    by timestamp, so when the container is being asked for a venv to use,</span>
<span class="sd">    the current latest available one will be sorted out.</span>

<span class="sd">    The location of the container can be set with env var `REZUP_ROOT_LOCAL`</span>
<span class="sd">    or `~/.rezup` will be used by default.</span>

<span class="sd">    For centralize management in production, one remote container can be</span>
<span class="sd">    defined with an env var `REZUP_ROOT_REMOTE`. The remote container only</span>
<span class="sd">    contains the venv installation manifest file, and when being asked, a</span>
<span class="sd">    venv will be created locally or re-used if same revision exists in local.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (`str`, optional): Container name, use `Container.DEFAULT_NAME`</span>
<span class="sd">            if not given.</span>
<span class="sd">        recipe (`ContainerRecipe`, optional): A `ContainerRecipe` object to</span>
<span class="sd">            help constructing container, will look into `ContainerRecipe.RECIPES_DIR`</span>
<span class="sd">            if not given.</span>
<span class="sd">        force_local (`bool`, optional): Default `False`. Ignore linking remote</span>
<span class="sd">            even if the remote path has set, always link to local if `True`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_NAME</span> <span class="o">=</span> <span class="n">DEFAULT_CONTAINER_NAME</span>  <span class="c1">#: `rezup.recipe.DEFAULT_CONTAINER_NAME`</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_local</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_NAME</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">recipe</span> <span class="ow">or</span> <span class="n">ContainerRecipe</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">local_root</span> <span class="o">=</span> <span class="n">get_container_root</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="n">remote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">remote_root</span> <span class="o">=</span> <span class="n">get_container_root</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="n">remote</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">force_local</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">local_root</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">remote_root</span> <span class="ow">or</span> <span class="n">local_root</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_remote</span> <span class="o">=</span> <span class="n">root</span> <span class="o">==</span> <span class="n">remote_root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recipe</span> <span class="o">=</span> <span class="n">recipe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">root</span> <span class="o">/</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(remote=</span><span class="si">%d</span><span class="s2">, name=</span><span class="si">%r</span><span class="s2">, path=</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_remote</span><span class="p">()),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">force_local</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create container from recipe.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of container.</span>
<span class="sd">            force_local (bool): Create as local if True, or try remote.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `Container`: A container instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">ContainerRecipe</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sourcing recipe from: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">recipe</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recipe</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Recipe file not exists, creating default..&quot;</span><span class="p">)</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Container</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">force_local</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            `pathlib.Path`: Path to where this container is located.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: Container name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            `pathlib.Path`: Full path of this container.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">recipe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            `ContainerRecipe`: The recipe instance that binds to this container.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recipe</span>

    <span class="k">def</span> <span class="nf">libs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            `pathlib.Path`: Path to this container&#39;s shared libraries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">/</span> <span class="s2">&quot;libs&quot;</span>

    <span class="k">def</span> <span class="nf">revisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            `pathlib.Path`: Path to this container&#39;s revisions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">/</span> <span class="s2">&quot;revisions&quot;</span>

    <span class="k">def</span> <span class="nf">is_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: Return `True` if this container exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: Return `True` if this container has no valid revisions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_revision</span><span class="p">(),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">is_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: Return `True` if this container is linked to remote side.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote</span>

    <span class="k">def</span> <span class="nf">purge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exists</span><span class="p">():</span>
            <span class="n">revision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_revision</span><span class="p">(</span><span class="n">only_ready</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">revision</span><span class="p">:</span>
                <span class="c1"># TODO: don&#39;t remove it immediately, mark as purged and</span>
                <span class="c1">#   remove it when $REZUP_CLEAN_AFTER meet</span>
                <span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO: should have better exception type</span>
                <span class="c1"># TODO: need to check revision is in use</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Revision is creating.&quot;</span><span class="p">)</span>

        <span class="c1"># keep tidy, try remove the root of containers if it&#39;s now empty</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">root</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">next</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">iterdir</span><span class="p">(),</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iter_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">latest_first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterating revisions from this container.</span>

<span class="sd">        Args:</span>
<span class="sd">            validate (bool, optional): Default `True`. Only yield revisions</span>
<span class="sd">                that are valid if `True`.</span>
<span class="sd">            latest_first (bool): Default `True`. Yield revisions based on</span>
<span class="sd">                it&#39;s directory name (timestamp string) in descending order,</span>
<span class="sd">                or ascending if `False`.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Revision: `Revision` instances that match the condition.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Iterating revisions in container </span><span class="si">%s</span><span class="s2">..&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exists</span><span class="p">():</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Container </span><span class="si">%r</span><span class="s2"> not exists.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
            <span class="k">return</span>

        <span class="n">revisions_root</span> <span class="o">=</span> <span class="n">Revision</span><span class="o">.</span><span class="n">compose_path</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">revisions_root</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Revision root is not a directory: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">revisions_root</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">revisions_root</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">revisions_root</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">revisions_root</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="n">latest_first</span><span class="p">):</span>
            <span class="n">revision</span> <span class="o">=</span> <span class="n">Revision</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirname</span><span class="o">=</span><span class="n">entry</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;... </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">revision</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate</span> <span class="ow">or</span> <span class="n">revision</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">revision</span>

    <span class="k">def</span> <span class="nf">get_latest_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get latest revision from this container.</span>

<span class="sd">        Args:</span>
<span class="sd">            only_ready (bool): Default `True`. Include revisions that are not</span>
<span class="sd">                in ready state if `False`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Revision: An instance of `Revision` if found, or `None`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">revision</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_revision</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_ready</span> <span class="ow">or</span> <span class="n">revision</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found latest revision.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">revision</span>

    <span class="k">def</span> <span class="nf">get_revision_by_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a revision that match the timestamp</span>

<span class="sd">        Args:</span>
<span class="sd">            timestamp (datetime.datetime): a time for matching revision</span>
<span class="sd">            fallback (bool): If True, accept earlier revision when no exact matched</span>
<span class="sd">            only_ready (bool): Include revisions that are not in ready state if False</span>

<span class="sd">        Returns:</span>
<span class="sd">            Revision: An instance of `Revision` if found, or `None`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">revision</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_revision</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_ready</span> <span class="ow">or</span> <span class="n">revision</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">revision</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">==</span> <span class="n">timestamp</span>
                        <span class="ow">or</span> <span class="p">(</span><span class="n">fallback</span> <span class="ow">and</span> <span class="n">revision</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">timestamp</span><span class="p">)):</span>

                    <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found time matched revision.&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">revision</span>

        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No time matched revision found.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">new_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new revision</span>

<span class="sd">        Returns:</span>
<span class="sd">            Revision: An instance of `Revision` that just created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Revision</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">force_local</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Create container from recipe.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>The name of container.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>force_local</code></td>
        <td><code>bool</code></td>
        <td><p>Create as local if True, or try remote.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>`Container`</code></td>
      <td><p>A container instance.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">force_local</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create container from recipe.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of container.</span>
<span class="sd">        force_local (bool): Create as local if True, or try remote.</span>

<span class="sd">    Returns:</span>
<span class="sd">        `Container`: A container instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">recipe</span> <span class="o">=</span> <span class="n">ContainerRecipe</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sourcing recipe from: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">recipe</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">recipe</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Recipe file not exists, creating default..&quot;</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Container</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">force_local</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.get_latest_revision" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_latest_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Get latest revision from this container.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>only_ready</code></td>
        <td><code>bool</code></td>
        <td><p>Default <code>True</code>. Include revisions that are not
in ready state if <code>False</code>.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Revision</code></td>
      <td><p>An instance of <code>Revision</code> if found, or <code>None</code>.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_latest_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get latest revision from this container.</span>

<span class="sd">    Args:</span>
<span class="sd">        only_ready (bool): Default `True`. Include revisions that are not</span>
<span class="sd">            in ready state if `False`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Revision: An instance of `Revision` if found, or `None`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">revision</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_revision</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_ready</span> <span class="ow">or</span> <span class="n">revision</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found latest revision.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">revision</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.get_revision_by_time" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_revision_by_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Returns a revision that match the timestamp</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>timestamp</code></td>
        <td><code>datetime.datetime</code></td>
        <td><p>a time for matching revision</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>fallback</code></td>
        <td><code>bool</code></td>
        <td><p>If True, accept earlier revision when no exact matched</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>only_ready</code></td>
        <td><code>bool</code></td>
        <td><p>Include revisions that are not in ready state if False</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Revision</code></td>
      <td><p>An instance of <code>Revision</code> if found, or <code>None</code>.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_revision_by_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a revision that match the timestamp</span>

<span class="sd">    Args:</span>
<span class="sd">        timestamp (datetime.datetime): a time for matching revision</span>
<span class="sd">        fallback (bool): If True, accept earlier revision when no exact matched</span>
<span class="sd">        only_ready (bool): Include revisions that are not in ready state if False</span>

<span class="sd">    Returns:</span>
<span class="sd">        Revision: An instance of `Revision` if found, or `None`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">revision</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_revision</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_ready</span> <span class="ow">or</span> <span class="n">revision</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">revision</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">==</span> <span class="n">timestamp</span>
                    <span class="ow">or</span> <span class="p">(</span><span class="n">fallback</span> <span class="ow">and</span> <span class="n">revision</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">timestamp</span><span class="p">)):</span>

                <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found time matched revision.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">revision</span>

    <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No time matched revision found.&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.is_empty" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">


<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>Return <code>True</code> if this container has no valid revisions.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: Return `True` if this container has no valid revisions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_revision</span><span class="p">(),</span> <span class="kc">None</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.is_exists" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">


<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>Return <code>True</code> if this container exists.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: Return `True` if this container exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.is_remote" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">


<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>Return <code>True</code> if this container is linked to remote side.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: Return `True` if this container is linked to remote side.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.iter_revision" class="doc doc-heading">
<code class="highlight language-python"><span class="n">iter_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">latest_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Iterating revisions from this container.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>validate</code></td>
        <td><code>bool</code></td>
        <td><p>Default <code>True</code>. Only yield revisions
that are valid if <code>True</code>.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>latest_first</code></td>
        <td><code>bool</code></td>
        <td><p>Default <code>True</code>. Yield revisions based on
it's directory name (timestamp string) in descending order,
or ascending if <code>False</code>.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Yields:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Revision</code></td>
      <td><p><code>Revision</code> instances that match the condition.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">iter_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">latest_first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iterating revisions from this container.</span>

<span class="sd">    Args:</span>
<span class="sd">        validate (bool, optional): Default `True`. Only yield revisions</span>
<span class="sd">            that are valid if `True`.</span>
<span class="sd">        latest_first (bool): Default `True`. Yield revisions based on</span>
<span class="sd">            it&#39;s directory name (timestamp string) in descending order,</span>
<span class="sd">            or ascending if `False`.</span>

<span class="sd">    Yields:</span>
<span class="sd">        Revision: `Revision` instances that match the condition.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Iterating revisions in container </span><span class="si">%s</span><span class="s2">..&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exists</span><span class="p">():</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Container </span><span class="si">%r</span><span class="s2"> not exists.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
        <span class="k">return</span>

    <span class="n">revisions_root</span> <span class="o">=</span> <span class="n">Revision</span><span class="o">.</span><span class="n">compose_path</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">revisions_root</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Revision root is not a directory: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">revisions_root</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">revisions_root</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">revisions_root</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">revisions_root</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="n">latest_first</span><span class="p">):</span>
        <span class="n">revision</span> <span class="o">=</span> <span class="n">Revision</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirname</span><span class="o">=</span><span class="n">entry</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;... </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">revision</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate</span> <span class="ow">or</span> <span class="n">revision</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">revision</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.libs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">libs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">


<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>`pathlib.Path`</code></td>
      <td><p>Path to this container's shared libraries.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">libs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        `pathlib.Path`: Path to this container&#39;s shared libraries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">/</span> <span class="s2">&quot;libs&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">


<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Container name.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: Container name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.new_revision" class="doc doc-heading">
<code class="highlight language-python"><span class="n">new_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Create a new revision</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Revision</code></td>
      <td><p>An instance of <code>Revision</code> that just created.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">new_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a new revision</span>

<span class="sd">    Returns:</span>
<span class="sd">        Revision: An instance of `Revision` that just created.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Revision</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">


<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>`pathlib.Path`</code></td>
      <td><p>Full path of this container.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        `pathlib.Path`: Full path of this container.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.recipe" class="doc doc-heading">
<code class="highlight language-python"><span class="n">recipe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">


<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>`ContainerRecipe`</code></td>
      <td><p>The recipe instance that binds to this container.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">recipe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        `ContainerRecipe`: The recipe instance that binds to this container.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recipe</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.revisions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">revisions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">


<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>`pathlib.Path`</code></td>
      <td><p>Path to this container's revisions.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">revisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        `pathlib.Path`: Path to this container&#39;s revisions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">/</span> <span class="s2">&quot;revisions&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Container.root" class="doc doc-heading">
<code class="highlight language-python"><span class="n">root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">


<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>`pathlib.Path`</code></td>
      <td><p>Path to where this container is located.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        `pathlib.Path`: Path to where this container is located.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h1 id="revision">Revision</h1>


  <div class="doc doc-object doc-class">

<a id="rezup.container.Revision"></a>
    <div class="doc doc-contents first">


<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>container</code></td>
        <td><code>Container</code></td>
        <td><p>The container that holds this revision</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dirname</code></td>
        <td><code>str</code></td>
        <td><p>Directory name of this revision, should be
a timestamp string if given.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Revision</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        container (Container): The container that holds this revision</span>
<span class="sd">        dirname (str, optional): Directory name of this revision, should be</span>
<span class="sd">            a timestamp string if given.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">dirname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dirname</span> <span class="ow">or</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_container</span> <span class="o">=</span> <span class="n">container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span> <span class="o">=</span> <span class="n">dirname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compose_path</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">dirname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recipe</span> <span class="o">=</span> <span class="n">RevisionRecipe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">/</span> <span class="s2">&quot;revision.json&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_pulled</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(valid=</span><span class="si">%d</span><span class="s2">, ready=</span><span class="si">%d</span><span class="s2">, remote=</span><span class="si">%d</span><span class="s2">, time=</span><span class="si">%s</span><span class="s2">, path=</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()),</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">()),</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_remote</span><span class="p">()),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_str</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;?&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> \
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">compose_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">dirname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">revisions</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dirname</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">/=</span> <span class="n">dirname</span>
        <span class="k">return</span> <span class="n">path</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">container</span><span class="p">):</span>
        <span class="n">revision</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">)</span>
        <span class="n">revision</span><span class="o">.</span><span class="n">_write</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">revision</span>

    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulling</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sourcing recipe and create a revision</span>

<span class="sd">        Args:</span>
<span class="sd">            pulling (Revision, optional): If given, pulling recipe from that</span>
<span class="sd">                revision, usually a remote one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating revision..&quot;</span><span class="p">)</span>

        <span class="n">recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recipe</span>
        <span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>

        <span class="c1"># write revision recipe</span>
        <span class="k">if</span> <span class="n">pulling</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Recipe sourced from: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">recipe</span><span class="p">())</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Pulling recipe from: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pulling</span><span class="p">)</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="n">pulling</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid new revision, this is a bug.&quot;</span><span class="p">)</span>

        <span class="c1"># manifest</span>
        <span class="n">rez_</span> <span class="o">=</span> <span class="n">Tool</span><span class="p">(</span><span class="n">recipe</span><span class="p">[</span><span class="s2">&quot;rez&quot;</span><span class="p">])</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tool</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">recipe</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extension&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">d</span><span class="p">]</span>
        <span class="n">shared_lib</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shared&quot;</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Recipe loaded.&quot;</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;       Rez: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rez_</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot; Extension: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">]))</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Shared-lib: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">shared_lib</span><span class="p">)</span>

        <span class="c1"># install, if at local</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">is_remote</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_install</span><span class="p">(</span><span class="n">rez_</span><span class="p">,</span> <span class="n">extensions</span><span class="p">,</span> <span class="n">shared_lib</span><span class="p">)</span>

        <span class="c1"># save metadata, mark revision as ready</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_path</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># metadata</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
                <span class="s2">&quot;rezup_version&quot;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
                <span class="s2">&quot;creator&quot;</span><span class="p">:</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">(),</span>
                <span class="s2">&quot;hostname&quot;</span><span class="p">:</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span>
                <span class="s2">&quot;revision_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">),</span>
                <span class="s2">&quot;venvs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rez&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">extensions</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">isolation</span><span class="p">],</span>
            <span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

        <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Revision created: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rez_</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shared_lib</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct Rez virtual environment by recipe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Installing..&quot;</span><span class="p">)</span>

        <span class="n">pip_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recipe</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pip&quot;</span><span class="p">)</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="n">extensions</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">installer</span> <span class="o">=</span> <span class="n">Installer</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">pip_opt</span><span class="o">=</span><span class="n">pip_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">),</span>
            <span class="n">pip_env</span><span class="o">=</span><span class="n">pip_entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">installer</span><span class="o">.</span><span class="n">install_rez</span><span class="p">(</span><span class="n">rez_</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">shared_lib</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Shared-lib section is about to be deprecated, &quot;</span>
                          <span class="s2">&quot;use &#39;rez.lib&#39; or &#39;extension.lib&#39; section instead. &quot;</span>
                          <span class="s2">&quot;See https://github.com/davidlatwe/rezup/issues/62&quot;</span><span class="p">,</span>
                          <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="n">installer</span><span class="o">.</span><span class="n">create_shared_lib</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">shared_lib</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                                        <span class="n">requires</span><span class="o">=</span><span class="n">shared_lib</span><span class="p">[</span><span class="s2">&quot;requires&quot;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="n">installer</span><span class="o">.</span><span class="n">install_extension</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">is_valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span><span class="p">)</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recipe</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">is_valid</span>

    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid</span>

    <span class="k">def</span> <span class="nf">is_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">is_remote</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">dirname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span>

    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

    <span class="k">def</span> <span class="nf">timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span>

    <span class="k">def</span> <span class="nf">time_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.%b.%y %H:%M&quot;</span><span class="p">)</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">container</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span>

    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_path</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span>

    <span class="k">def</span> <span class="nf">recipe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recipe</span>

    <span class="k">def</span> <span class="nf">recipe_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipe</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">env</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span> <span class="nf">load_env</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dotenv_values</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># exclude config section line</span>
            <span class="p">}</span>

        <span class="k">def</span> <span class="nf">file_loader</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([</span>
                <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)])]</span>

        <span class="n">dot_env</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dotenv&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dot_env</span><span class="p">:</span>
            <span class="c1"># non platform specific dotenv</span>
            <span class="n">env_files</span> <span class="o">=</span> <span class="n">file_loader</span><span class="p">(</span><span class="n">dot_env</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dot_env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_platform</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># platform specific dotenv</span>
                <span class="n">env_files</span> <span class="o">+=</span> <span class="n">file_loader</span><span class="p">(</span><span class="n">dot_env</span><span class="p">[</span><span class="n">_platform</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">env_files</span><span class="p">:</span>
                <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">load_env</span><span class="p">(</span><span class="n">dotenv_path</span><span class="o">=</span><span class="n">file</span><span class="p">))</span>

        <span class="n">recipe_env</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">recipe_env</span><span class="p">:</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

            <span class="n">_parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
            <span class="n">_parser</span><span class="o">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="nb">str</span>  <span class="c1"># to prevent turning keys into lowercase</span>
            <span class="n">_parser</span><span class="o">.</span><span class="n">read_dict</span><span class="p">({</span><span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="n">recipe_env</span><span class="p">})</span>
            <span class="n">_parser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

            <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># must reset buffer</span>
            <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">load_env</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">))</span>

        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s2">&quot;REZUP_CONTAINER&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span>
            <span class="s2">&quot;REZUP_USING_REMOTE&quot;</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_pulled</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">env</span>

    <span class="k">def</span> <span class="nf">purge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1"># TODO: don&#39;t remove it immediately, mark as purged and</span>
            <span class="c1">#   remove it when $REZUP_CLEAN_AFTER meet</span>
            <span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iter_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">revision</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">iter_revision</span><span class="p">(</span><span class="n">latest_first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">revision</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">revision</span>

    <span class="k">def</span> <span class="nf">iter_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">revision</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">iter_revision</span><span class="p">(</span><span class="n">latest_first</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">revision</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">revision</span>

    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return corresponding local side revision</span>

<span class="sd">        If the revision is from remote container, calling this method will</span>
<span class="sd">        find a timestamp matched local revision and create one if not found</span>
<span class="sd">        by default.</span>

<span class="sd">        If the revision is from local container, return `self`.</span>

<span class="sd">        Args:</span>
<span class="sd">            check_out (bool, optional): When no matched local revision,</span>
<span class="sd">                create one if True or just return None at the end.</span>
<span class="sd">                Default is True.</span>
<span class="sd">            fallback (bool, optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Revision or None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_remote</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="c1"># get local</span>
        <span class="n">_con_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
        <span class="n">_con_recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">recipe</span><span class="p">()</span>  <span class="c1"># careful, this affect&#39;s root</span>

        <span class="n">local</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span><span class="n">_con_name</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">_con_recipe</span><span class="p">,</span> <span class="n">force_local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">rev</span> <span class="o">=</span> <span class="n">local</span><span class="o">.</span><span class="n">get_revision_by_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span><span class="p">,</span>
                                         <span class="n">fallback</span><span class="o">=</span><span class="n">fallback</span><span class="p">,</span>
                                         <span class="n">only_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">_allow_create</span> <span class="o">=</span> <span class="n">rev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">check_out</span>
        <span class="n">_did_fallback</span> <span class="o">=</span> <span class="n">rev</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span> <span class="k">if</span> <span class="n">rev</span> <span class="k">else</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fallback</span> <span class="ow">and</span> <span class="n">_allow_create</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pulling from remote container: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="p">)</span>
            <span class="n">rev</span> <span class="o">=</span> <span class="n">Revision</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="n">local</span><span class="p">,</span> <span class="n">dirname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span><span class="p">)</span>
            <span class="n">rev</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">pulling</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fallback</span> <span class="ow">and</span> <span class="n">_did_fallback</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Local revision at exact time (</span><span class="si">%s</span><span class="s2">) is not ready, &quot;</span>
                <span class="s2">&quot;fallback to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_str</span><span class="p">(),</span> <span class="n">rev</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">rev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rev</span><span class="o">.</span><span class="n">_is_pulled</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">rev</span>

    <span class="k">def</span> <span class="nf">spawn_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Spawn a sub-shell</span>

<span class="sd">        Args:</span>
<span class="sd">            command (list, optional): Shell script file with args or commands.</span>
<span class="sd">                If given, the sub-shell will not be interactive.</span>

<span class="sd">        Returns:</span>
<span class="sd">            subprocess.Popen</span>

<span class="sd">        Raises:</span>
<span class="sd">            ContainerError</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ContainerError</span><span class="p">(</span><span class="s2">&quot;Cannot use invalid revision.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ContainerError</span><span class="p">(</span><span class="s2">&quot;Revision is not ready to be used.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_remote</span><span class="p">():</span>
            <span class="c1"># use local</span>
            <span class="n">revision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">revision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ContainerError</span><span class="p">(</span><span class="s2">&quot;No revision pulled.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">revision</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ContainerError</span><span class="p">(</span><span class="s2">&quot;Revision is not ready to be used.&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">revision</span><span class="o">.</span><span class="n">spawn_shell</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Launch subprocess</span>
            <span class="n">environment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compose_env</span><span class="p">()</span>
            <span class="n">shell_name</span><span class="p">,</span> <span class="n">shell_exec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_shell</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">command</span><span class="p">:</span>
                <span class="c1"># run command and exit</span>
                <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="n">command</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">exe</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">exe</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">exe</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">environment</span><span class="p">)</span> <span class="ow">or</span> <span class="n">exe</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">exe</span><span class="p">]</span> <span class="o">+</span> <span class="n">command</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># interactive shell</span>
                <span class="n">_con_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
                <span class="n">_con_from</span> <span class="o">=</span> <span class="s2">&quot;remote&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_pulled</span> <span class="k">else</span> <span class="s2">&quot;local&quot;</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;rezup (</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">) &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_con_name</span><span class="p">,</span> <span class="n">_con_from</span><span class="p">)</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">format_prompt_code</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">shell_name</span><span class="p">)</span>
                <span class="n">environment</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                    <span class="s2">&quot;REZUP_PROMPT&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REZUP_PROMPT&quot;</span><span class="p">,</span> <span class="n">prompt</span><span class="p">),</span>
                <span class="p">})</span>

                <span class="n">cmd</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">get_launch_cmd</span><span class="p">(</span>
                    <span class="n">shell_name</span><span class="p">,</span>
                    <span class="n">shell_exec</span><span class="p">,</span>
                    <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">popen</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">environment</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">popen</span>

    <span class="k">def</span> <span class="nf">use</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run a sub-shell</span>

<span class="sd">        Args:</span>
<span class="sd">            command (list, optional): Shell script with args or commands. If</span>
<span class="sd">                given, the sub-shell will not be interactive.</span>
<span class="sd">            wait (bool, optional): Whether to wait `command` finish or not,</span>
<span class="sd">                default True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: subprocess return code, will always return 0 if `command`</span>
<span class="sd">                is given and `wait` is False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">block</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">command</span>
        <span class="n">popen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spawn_shell</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">block</span> <span class="ow">or</span> <span class="n">wait</span><span class="p">:</span>
            <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">popen</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">popen</span><span class="o">.</span><span class="n">returncode</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_compose_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recipe_env</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">env</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_bin_dirs</span><span class="p">()]),</span>
            <span class="n">env</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="c1"># use `pythonfinder` package if need to exclude python from PATH</span>

        <span class="k">return</span> <span class="n">env</span>

    <span class="k">def</span> <span class="nf">_get_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">shell_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REZUP_DEFAULT_SHELL&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shell_name</span><span class="p">:</span>
            <span class="n">shell_exec</span> <span class="o">=</span> <span class="n">shell_name</span>
            <span class="n">shell_name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">shell_name</span><span class="p">))</span>
            <span class="n">shell_name</span> <span class="o">=</span> <span class="n">shell_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shell_name</span><span class="p">,</span> <span class="n">shell_exec</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">get_current_shell</span><span class="p">()</span>
            <span class="n">shell_exec</span> <span class="o">=</span> <span class="n">shell_exec</span> <span class="ow">or</span> <span class="n">shell_name</span>

        <span class="k">return</span> <span class="n">shell_name</span><span class="p">,</span> <span class="n">shell_exec</span>

    <span class="k">def</span> <span class="nf">_require_local</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>  <span class="c1"># noqa</span>
        <span class="sd">&quot;&quot;&quot;Decorator for ensuring local revision exists before action</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>  <span class="c1"># noqa</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_remote</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># noqa</span>

            <span class="n">check_out</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REZUP_ALWAYS_CHECKOUT&quot;</span><span class="p">))</span>
            <span class="n">revision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="n">check_out</span><span class="o">=</span><span class="n">check_out</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">revision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ContainerError</span><span class="p">(</span>
                    <span class="s2">&quot;This revision is from remote container, no matched found &quot;</span>
                    <span class="s2">&quot;in local. Possible not been pulled into local yet.&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">revision</span><span class="p">,</span> <span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="nd">@_require_local</span>  <span class="c1"># noqa</span>
    <span class="k">def</span> <span class="nf">locate_rez_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">venv_session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns rez module location in this revision</span>

<span class="sd">        Returns:</span>
<span class="sd">            pathlib.Path or None if not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">venv_session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">venv_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;venv&quot;</span> <span class="o">/</span> <span class="s2">&quot;rez&quot;</span>
            <span class="n">venv_session</span> <span class="o">=</span> <span class="n">virtualenv</span><span class="o">.</span><span class="n">session_via_cli</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">venv_path</span><span class="p">)])</span>
        <span class="n">venv_lib</span> <span class="o">=</span> <span class="n">venv_session</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">purelib</span>

        <span class="c1"># rez may get installed in edit mode, try short route first</span>
        <span class="n">egg_link</span> <span class="o">=</span> <span class="n">venv_lib</span> <span class="o">/</span> <span class="s2">&quot;rez.egg-link&quot;</span>
        <span class="k">if</span> <span class="n">egg_link</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">egg_link</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">package_location</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">package_location</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">package_location</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">importer</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkgutil</span><span class="o">.</span><span class="n">walk_packages</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">venv_lib</span><span class="p">)]):</span>
            <span class="k">if</span> <span class="n">pkg</span> <span class="ow">and</span> <span class="n">modname</span> <span class="o">==</span> <span class="s2">&quot;rez&quot;</span><span class="p">:</span>
                <span class="n">loader</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">path</span>  <span class="c1"># SourceFileLoader</span>
                    <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">filename</span>  <span class="c1"># ImpLoader, py2</span>
                    <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>

    <span class="nd">@_require_local</span>  <span class="c1"># noqa</span>
    <span class="k">def</span> <span class="nf">get_rez_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">venv_session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns rez version installed in this revision</span>

<span class="sd">        Returns:</span>
<span class="sd">            str or None if not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rez_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locate_rez_lib</span><span class="p">(</span><span class="n">venv_session</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rez_location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">version_py</span> <span class="o">=</span> <span class="n">rez_location</span> <span class="o">/</span> <span class="s2">&quot;rez&quot;</span> <span class="o">/</span> <span class="s2">&quot;utils&quot;</span> <span class="o">/</span> <span class="s2">&quot;_version.py&quot;</span>
        <span class="k">if</span> <span class="n">version_py</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">_locals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;_rez_version&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version_py</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">exec</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="n">_locals</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_locals</span><span class="p">[</span><span class="s2">&quot;_rez_version&quot;</span><span class="p">]</span>

    <span class="nd">@_require_local</span>  <span class="c1"># noqa</span>
    <span class="k">def</span> <span class="nf">production_bin_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">venv_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns production bin scripts dir in this revision</span>

<span class="sd">        Returns:</span>
<span class="sd">            pathlib.Path, but the directory may not exists.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bin_dirname</span> <span class="o">=</span> <span class="s2">&quot;Scripts&quot;</span> <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span> <span class="k">else</span> <span class="s2">&quot;bin&quot;</span>
        <span class="n">venv_bin_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;venv&quot;</span> <span class="o">/</span> <span class="n">venv_name</span> <span class="o">/</span> <span class="n">bin_dirname</span>
        <span class="k">return</span> <span class="n">venv_bin_dir</span> <span class="o">/</span> <span class="s2">&quot;rez&quot;</span>

    <span class="nd">@_require_local</span>  <span class="c1"># noqa</span>
    <span class="k">def</span> <span class="nf">production_bin_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bin_dirs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rezup_version&quot;</span><span class="p">):</span>
            <span class="c1"># rezup-1.x</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Is a &#39;rezup-1.x&#39; styled revision.&quot;</span><span class="p">)</span>
            <span class="n">bin_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">/</span> <span class="s2">&quot;bin&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># rezup-2.x</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Is a &#39;rezup-2.x&#39; styled revision.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">venv_name</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;venvs&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">bin_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">production_bin_dir</span><span class="p">(</span><span class="n">venv_name</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">bin_dirs</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Revision.get_rez_version" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_rez_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">venv_session</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Returns rez version installed in this revision</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>str or None if not found.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@_require_local</span>  <span class="c1"># noqa</span>
<span class="k">def</span> <span class="nf">get_rez_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">venv_session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns rez version installed in this revision</span>

<span class="sd">    Returns:</span>
<span class="sd">        str or None if not found.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rez_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locate_rez_lib</span><span class="p">(</span><span class="n">venv_session</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rez_location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">version_py</span> <span class="o">=</span> <span class="n">rez_location</span> <span class="o">/</span> <span class="s2">&quot;rez&quot;</span> <span class="o">/</span> <span class="s2">&quot;utils&quot;</span> <span class="o">/</span> <span class="s2">&quot;_version.py&quot;</span>
    <span class="k">if</span> <span class="n">version_py</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="n">_locals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;_rez_version&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">version_py</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">exec</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="n">_locals</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_locals</span><span class="p">[</span><span class="s2">&quot;_rez_version&quot;</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>








  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Revision.locate_rez_lib" class="doc doc-heading">
<code class="highlight language-python"><span class="n">locate_rez_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">venv_session</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Returns rez module location in this revision</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>pathlib.Path or None if not found.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@_require_local</span>  <span class="c1"># noqa</span>
<span class="k">def</span> <span class="nf">locate_rez_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">venv_session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns rez module location in this revision</span>

<span class="sd">    Returns:</span>
<span class="sd">        pathlib.Path or None if not found.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">venv_session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">venv_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;venv&quot;</span> <span class="o">/</span> <span class="s2">&quot;rez&quot;</span>
        <span class="n">venv_session</span> <span class="o">=</span> <span class="n">virtualenv</span><span class="o">.</span><span class="n">session_via_cli</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">venv_path</span><span class="p">)])</span>
    <span class="n">venv_lib</span> <span class="o">=</span> <span class="n">venv_session</span><span class="o">.</span><span class="n">creator</span><span class="o">.</span><span class="n">purelib</span>

    <span class="c1"># rez may get installed in edit mode, try short route first</span>
    <span class="n">egg_link</span> <span class="o">=</span> <span class="n">venv_lib</span> <span class="o">/</span> <span class="s2">&quot;rez.egg-link&quot;</span>
    <span class="k">if</span> <span class="n">egg_link</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">egg_link</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">package_location</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">package_location</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">package_location</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">importer</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkgutil</span><span class="o">.</span><span class="n">walk_packages</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">venv_lib</span><span class="p">)]):</span>
        <span class="k">if</span> <span class="n">pkg</span> <span class="ow">and</span> <span class="n">modname</span> <span class="o">==</span> <span class="s2">&quot;rez&quot;</span><span class="p">:</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">path</span>  <span class="c1"># SourceFileLoader</span>
                <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">filename</span>  <span class="c1"># ImpLoader, py2</span>
                <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Revision.production_bin_dir" class="doc doc-heading">
<code class="highlight language-python"><span class="n">production_bin_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">venv_name</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Returns production bin scripts dir in this revision</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>pathlib.Path, but the directory may not exists.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@_require_local</span>  <span class="c1"># noqa</span>
<span class="k">def</span> <span class="nf">production_bin_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">venv_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns production bin scripts dir in this revision</span>

<span class="sd">    Returns:</span>
<span class="sd">        pathlib.Path, but the directory may not exists.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bin_dirname</span> <span class="o">=</span> <span class="s2">&quot;Scripts&quot;</span> <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span> <span class="k">else</span> <span class="s2">&quot;bin&quot;</span>
    <span class="n">venv_bin_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;venv&quot;</span> <span class="o">/</span> <span class="n">venv_name</span> <span class="o">/</span> <span class="n">bin_dirname</span>
    <span class="k">return</span> <span class="n">venv_bin_dir</span> <span class="o">/</span> <span class="s2">&quot;rez&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Revision.pull" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Return corresponding local side revision</p>
<p>If the revision is from remote container, calling this method will
find a timestamp matched local revision and create one if not found
by default.</p>
<p>If the revision is from local container, return <code>self</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>check_out</code></td>
        <td><code>bool</code></td>
        <td><p>When no matched local revision,
create one if True or just return None at the end.
Default is True.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>Revision or None</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return corresponding local side revision</span>

<span class="sd">    If the revision is from remote container, calling this method will</span>
<span class="sd">    find a timestamp matched local revision and create one if not found</span>
<span class="sd">    by default.</span>

<span class="sd">    If the revision is from local container, return `self`.</span>

<span class="sd">    Args:</span>
<span class="sd">        check_out (bool, optional): When no matched local revision,</span>
<span class="sd">            create one if True or just return None at the end.</span>
<span class="sd">            Default is True.</span>
<span class="sd">        fallback (bool, optional)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Revision or None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_remote</span><span class="p">():</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># get local</span>
    <span class="n">_con_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
    <span class="n">_con_recipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">recipe</span><span class="p">()</span>  <span class="c1"># careful, this affect&#39;s root</span>

    <span class="n">local</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span><span class="n">_con_name</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="n">_con_recipe</span><span class="p">,</span> <span class="n">force_local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">rev</span> <span class="o">=</span> <span class="n">local</span><span class="o">.</span><span class="n">get_revision_by_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span><span class="p">,</span>
                                     <span class="n">fallback</span><span class="o">=</span><span class="n">fallback</span><span class="p">,</span>
                                     <span class="n">only_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">_allow_create</span> <span class="o">=</span> <span class="n">rev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">check_out</span>
    <span class="n">_did_fallback</span> <span class="o">=</span> <span class="n">rev</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp</span> <span class="k">if</span> <span class="n">rev</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">fallback</span> <span class="ow">and</span> <span class="n">_allow_create</span><span class="p">:</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pulling from remote container: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="p">)</span>
        <span class="n">rev</span> <span class="o">=</span> <span class="n">Revision</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="n">local</span><span class="p">,</span> <span class="n">dirname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span><span class="p">)</span>
        <span class="n">rev</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">pulling</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fallback</span> <span class="ow">and</span> <span class="n">_did_fallback</span><span class="p">:</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Local revision at exact time (</span><span class="si">%s</span><span class="s2">) is not ready, &quot;</span>
            <span class="s2">&quot;fallback to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_str</span><span class="p">(),</span> <span class="n">rev</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">rev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rev</span><span class="o">.</span><span class="n">_is_pulled</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">rev</span>
</code></pre></div>
        </details>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Revision.spawn_shell" class="doc doc-heading">
<code class="highlight language-python"><span class="n">spawn_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Spawn a sub-shell</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>command</code></td>
        <td><code>list</code></td>
        <td><p>Shell script file with args or commands.
If given, the sub-shell will not be interactive.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>subprocess.Popen</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">spawn_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Spawn a sub-shell</span>

<span class="sd">    Args:</span>
<span class="sd">        command (list, optional): Shell script file with args or commands.</span>
<span class="sd">            If given, the sub-shell will not be interactive.</span>

<span class="sd">    Returns:</span>
<span class="sd">        subprocess.Popen</span>

<span class="sd">    Raises:</span>
<span class="sd">        ContainerError</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">ContainerError</span><span class="p">(</span><span class="s2">&quot;Cannot use invalid revision.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">ContainerError</span><span class="p">(</span><span class="s2">&quot;Revision is not ready to be used.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_remote</span><span class="p">():</span>
        <span class="c1"># use local</span>
        <span class="n">revision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">revision</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ContainerError</span><span class="p">(</span><span class="s2">&quot;No revision pulled.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">revision</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ContainerError</span><span class="p">(</span><span class="s2">&quot;Revision is not ready to be used.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">revision</span><span class="o">.</span><span class="n">spawn_shell</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Launch subprocess</span>
        <span class="n">environment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compose_env</span><span class="p">()</span>
        <span class="n">shell_name</span><span class="p">,</span> <span class="n">shell_exec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_shell</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">command</span><span class="p">:</span>
            <span class="c1"># run command and exit</span>
            <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">command</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exe</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">exe</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">exe</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">environment</span><span class="p">)</span> <span class="ow">or</span> <span class="n">exe</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">exe</span><span class="p">]</span> <span class="o">+</span> <span class="n">command</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># interactive shell</span>
            <span class="n">_con_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
            <span class="n">_con_from</span> <span class="o">=</span> <span class="s2">&quot;remote&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_pulled</span> <span class="k">else</span> <span class="s2">&quot;local&quot;</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;rezup (</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">) &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_con_name</span><span class="p">,</span> <span class="n">_con_from</span><span class="p">)</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">format_prompt_code</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">shell_name</span><span class="p">)</span>
            <span class="n">environment</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s2">&quot;REZUP_PROMPT&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REZUP_PROMPT&quot;</span><span class="p">,</span> <span class="n">prompt</span><span class="p">),</span>
            <span class="p">})</span>

            <span class="n">cmd</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">get_launch_cmd</span><span class="p">(</span>
                <span class="n">shell_name</span><span class="p">,</span>
                <span class="n">shell_exec</span><span class="p">,</span>
                <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">popen</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">environment</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">popen</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h2 id="rezup.container.Revision.use" class="doc doc-heading">
<code class="highlight language-python"><span class="n">use</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Run a sub-shell</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>command</code></td>
        <td><code>list</code></td>
        <td><p>Shell script with args or commands. If
given, the sub-shell will not be interactive.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>wait</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to wait <code>command</code> finish or not,
default True.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>int</code></td>
      <td><p>subprocess return code, will always return 0 if <code>command</code>
    is given and <code>wait</code> is False.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>rezup/container.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">use</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run a sub-shell</span>

<span class="sd">    Args:</span>
<span class="sd">        command (list, optional): Shell script with args or commands. If</span>
<span class="sd">            given, the sub-shell will not be interactive.</span>
<span class="sd">        wait (bool, optional): Whether to wait `command` finish or not,</span>
<span class="sd">            default True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: subprocess return code, will always return 0 if `command`</span>
<span class="sd">            is given and `wait` is False.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">command</span>
    <span class="n">popen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spawn_shell</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">block</span> <span class="ow">or</span> <span class="n">wait</span><span class="p">:</span>
        <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">popen</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">popen</span><span class="o">.</span><span class="n">returncode</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>

<h1 id="containererror">ContainerError</h1>


  <div class="doc doc-object doc-class">

<a id="rezup.exceptions.ContainerError"></a>
    <div class="doc doc-contents first">

      <p>Any error that related to the container</p>

        <details class="quote">
          <summary>Source code in <code>rezup/exceptions.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ContainerError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Any error that related to the container&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div>
        </details>


    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../environ/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Environ" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Environ
            </div>
          </div>
        </a>
      
      
        
        <a href="../rezup.util/" class="md-footer__link md-footer__link--next" aria-label="Next: rezup.util" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              rezup.util
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.sections"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>